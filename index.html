<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Booze Lab – Premium Cocktail</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    body{background:#05050d;font-family:'DM Sans',sans-serif;overflow:hidden;}
    :root{--gold:#c9a84c;--cream:#f0e6c8;--teal:#00c4b8;--purple:#6c3fa0;}

    /* ── DESKTOP: side-by-side grid ── */
    #page{
      width:100vw;height:100vh;
      background:radial-gradient(ellipse at 18% 12%,#12082e 0%,transparent 50%),
        radial-gradient(ellipse at 88% 90%,#0a1a1a 0%,transparent 45%),#05050d;
      display:grid;grid-template-columns:1fr 1fr;align-items:center;
      padding:0 8vw;position:relative;overflow:hidden;
    }

    /* ── MOBILE: stack vertically, hero top / can bottom ── */
    @media(max-width:640px){
      body{overflow:hidden;}
      #page{
        grid-template-columns:1fr;
        grid-template-rows:auto 1fr;
        align-items:start;
        padding:3.5rem 6vw 0;
        gap:0;
      }
      .hero{
        text-align:center;align-items:center;
        gap:.9rem;max-width:100%;
      }
      .hero-title{font-size:clamp(3.5rem,18vw,6rem);}
      .subtitle{display:none;}
      .cta-row{justify-content:center;}
      .btn-secondary{display:none;}
      #can-stage{display:none;}
      .corner{display:none;}
    }

    #page::after{
      content:'';position:fixed;inset:0;pointer-events:none;z-index:20;opacity:.4;
      background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.045'/%3E%3C/svg%3E");
    }
    .bg-glow{position:absolute;border-radius:50%;filter:blur(100px);pointer-events:none;animation:gp 10s ease-in-out infinite alternate;}
    .bg-glow-1{width:500px;height:500px;background:#4a1880;opacity:.09;top:-140px;left:-100px;}
    .bg-glow-2{width:350px;height:350px;background:#006655;opacity:.10;bottom:-80px;right:4%;animation-duration:7s;animation-delay:1s;animation-direction:alternate-reverse;}
    .bg-glow-3{width:200px;height:200px;background:#c9a84c;opacity:.06;top:40%;left:40%;animation-duration:12s;animation-delay:2s;}
    @keyframes gp{to{transform:scale(1.4);}}
    .corner{position:absolute;width:52px;height:52px;opacity:.2;z-index:2;}
    .corner-tl{top:1.8rem;left:1.8rem;border-top:1px solid var(--teal);border-left:1px solid var(--teal);}
    .corner-br{bottom:1.8rem;right:1.8rem;border-bottom:1px solid var(--gold);border-right:1px solid var(--gold);}
    .hero{display:flex;flex-direction:column;gap:1.4rem;position:relative;z-index:3;max-width:480px;}
    .eyebrow{font-size:.7rem;letter-spacing:.5em;text-transform:uppercase;color:var(--teal);opacity:0;animation:fadeUp .8s ease forwards .3s;}
    .hero-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(5rem,10vw,9rem);line-height:.86;opacity:0;animation:fadeUp .8s ease forwards .55s;}
    .title-ghost{display:block;-webkit-text-stroke:1.5px rgba(201,168,76,.2);color:transparent;}
    .title-solid{display:block;color:var(--cream);}
    .tagline{font-size:.85rem;font-style:italic;font-weight:300;color:var(--gold);letter-spacing:.08em;opacity:0;animation:fadeUp .8s ease forwards .75s;}
    .subtitle{font-size:.95rem;color:rgba(240,230,200,.38);font-weight:300;line-height:1.9;max-width:320px;opacity:0;animation:fadeUp .8s ease forwards .95s;}
    .cta-row{display:flex;gap:1rem;align-items:center;opacity:0;animation:fadeUp .8s ease forwards 1.2s;}
    .btn-primary{
      background:linear-gradient(135deg,#c9a84c,#f0e6c8,#c9a84c);background-size:200% 100%;
      color:#05050d;border:none;padding:.88rem 2.5rem;font-family:'DM Sans',sans-serif;
      font-size:.8rem;font-weight:700;letter-spacing:.15em;text-transform:uppercase;cursor:pointer;
      transition:background-position .4s,transform .2s,box-shadow .2s;
      clip-path:polygon(10px 0%,100% 0%,calc(100% - 10px) 100%,0% 100%);
    }
    .btn-primary:hover,.btn-primary:active{background-position:100%;transform:translateY(-2px);box-shadow:0 14px 40px rgba(201,168,76,.4);}
    .btn-secondary{
      background:transparent;color:rgba(240,230,200,.4);border:1px solid rgba(201,168,76,.2);
      padding:.88rem 2rem;font-family:'DM Sans',sans-serif;font-size:.8rem;
      letter-spacing:.15em;text-transform:uppercase;cursor:pointer;transition:color .2s,border-color .2s;
    }
    .btn-secondary:hover{color:var(--cream);border-color:var(--gold);}
    @keyframes fadeUp{from{opacity:0;transform:translateY(26px);}to{opacity:1;transform:translateY(0);}}
    #can-stage{position:relative;z-index:4;}
    #can-wrap{position:fixed;pointer-events:none;transform-origin:center center;}
    .tdot{position:fixed;border-radius:50%;pointer-events:none;}
    .drip{position:fixed;border-radius:50% 50% 65% 65%;pointer-events:none;animation:dripFall .75s ease-in infinite;}
    @keyframes dripFall{0%{transform:translateY(0) scaleX(1);opacity:1;}100%{transform:translateY(44px) scaleX(.35);opacity:0;}}
    #all-gone{
      position:fixed;pointer-events:none;font-family:'Bebas Neue',sans-serif;
      font-size:clamp(.9rem,2vw,1.3rem);letter-spacing:.45em;color:rgba(201,168,76,.9);
      white-space:nowrap;z-index:10;opacity:0;transform:translateX(-50%);transition:opacity .9s ease;
    }
    #bottom-bar{
      position:absolute;bottom:0;left:0;right:0;height:2px;
      background:linear-gradient(90deg,transparent,var(--purple),var(--gold),var(--teal),transparent);
      animation:shimmer 3.5s ease-in-out infinite;z-index:3;
    }
    @keyframes shimmer{0%,100%{opacity:.3}50%{opacity:.9}}
    @keyframes bubbleRise{
      0%{transform:translateY(0) scale(1);opacity:.9;}
      100%{transform:translateY(-90px) scale(.06);opacity:0;}
    }
  </style>
</head>
<body>
<div id="page">
  <div class="bg-glow bg-glow-1"></div>
  <div class="bg-glow bg-glow-2"></div>
  <div class="bg-glow bg-glow-3"></div>
  <div class="corner corner-tl"></div>
  <div class="corner corner-br"></div>
  <div class="hero">
    <p class="eyebrow">Crafted · 2026 · Booze Better</p>
    <h1 class="hero-title">
      <span class="title-ghost">BOOZE</span>
      <span class="title-solid">LAB</span>
    </h1>
    <p class="tagline">— Distilled for those who know —</p>
    <p class="subtitle">Bold spirits. Pure flavour. Exceptional taste. Ready to drink.</p>
    <div class="cta-row">
      <button class="btn-primary">Shop Now</button>
      <button class="btn-secondary">Our Range →</button>
    </div>
  </div>
  <div id="can-stage"></div>
  <div id="all-gone">ALL GONE</div>
  <div id="bottom-bar"></div>
</div>
<div id="can-wrap"></div>

<script>
(function(){
  'use strict';

  // ── Easing ──
  const ease3 = t => 1-Math.pow(1-t,3);
  const ease2 = t => 1-(1-t)*(1-t);
  const eio2  = t => t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;
  const lerp  = (a,b,t) => a+(b-a)*t;
  const clamp = (v,a,b) => Math.max(a,Math.min(b,v));

  // ── Responsive size & positions — MUST be defined before buildSVG ──
  const MOBILE = () => window.innerWidth <= 640;
  const CAN_W  = () => MOBILE() ? 130 : 200;
  const CAN_H  = () => MOBILE() ? 286 : 440;
  const CX     = () => window.innerWidth  * 0.50;
  const CY     = () => window.innerHeight * 0.50;
  const TOP_Y  = () => CAN_H() / 2 + 15;
  const RST_X  = () => MOBILE() ? window.innerWidth  * 0.50 : window.innerWidth  * 0.75;
  const RST_Y  = () => MOBILE() ? window.innerHeight * 0.68 : window.innerHeight * 0.50;

  const LIQ_TOP=31, LIQ_BOT=184, LIQ_H=153;
  const NS = 'http://www.w3.org/2000/svg';

  /* Build the can using DOM API so elements are proper SVG nodes */
  function buildSVG() {
    const cw=CAN_W(), ch=CAN_H();
    const svg = document.createElementNS(NS,'svg');
    svg.setAttribute('viewBox','0 0 100 220');
    svg.setAttribute('width', cw);
    svg.setAttribute('height', ch);
    svg.style.overflow='visible';
    svg.style.display='block';

    // ── DEFS ──
    const defs = document.createElementNS(NS,'defs');
    defs.innerHTML = `
      <linearGradient id="gB" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%"   stop-color="#111118"/>
        <stop offset="8%"   stop-color="#1e1e28"/>
        <stop offset="20%"  stop-color="#161620"/>
        <stop offset="38%"  stop-color="#0e0e16"/>
        <stop offset="52%"  stop-color="#12121c"/>
        <stop offset="70%"  stop-color="#0a0a12"/>
        <stop offset="85%"  stop-color="#161620"/>
        <stop offset="100%" stop-color="#0a0a10"/>
      </linearGradient>
      <linearGradient id="gN" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%"   stop-color="#3a3a48"/>
        <stop offset="30%"  stop-color="#6a6a80"/>
        <stop offset="55%"  stop-color="#7a7a96"/>
        <stop offset="80%"  stop-color="#5a5a70"/>
        <stop offset="100%" stop-color="#2e2e3c"/>
      </linearGradient>
      <linearGradient id="gG" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%"   stop-color="#4a2e04"/>
        <stop offset="18%"  stop-color="#b8942a"/>
        <stop offset="40%"  stop-color="#f0d060"/>
        <stop offset="55%"  stop-color="#fae070"/>
        <stop offset="72%"  stop-color="#e0b840"/>
        <stop offset="88%"  stop-color="#a07820"/>
        <stop offset="100%" stop-color="#4a2e04"/>
      </linearGradient>
      <linearGradient id="gT" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%"   stop-color="#002820"/>
        <stop offset="45%"  stop-color="#00c4b8"/>
        <stop offset="100%" stop-color="#002820"/>
      </linearGradient>
      <linearGradient id="gSpirit" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%"   stop-color="rgba(255,210,90,0.45)"/>
        <stop offset="50%"  stop-color="rgba(220,155,35,0.38)"/>
        <stop offset="100%" stop-color="rgba(170,90,10,0.32)"/>
      </linearGradient>
      <linearGradient id="gSh" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%"   stop-color="rgba(255,255,255,0)"/>
        <stop offset="65%"  stop-color="rgba(255,255,255,0.12)"/>
        <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
      </linearGradient>
      <linearGradient id="gEd" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%"   stop-color="rgba(0,0,0,0)"/>
        <stop offset="100%" stop-color="rgba(0,0,0,0.55)"/>
      </linearGradient>
      <linearGradient id="gLid" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%"   stop-color="#454558"/>
        <stop offset="35%"  stop-color="#909098"/>
        <stop offset="58%"  stop-color="#a8a8b8"/>
        <stop offset="80%"  stop-color="#707080"/>
        <stop offset="100%" stop-color="#383848"/>
      </linearGradient>
      <radialGradient id="gLabel" cx="50%" cy="50%" r="70%">
        <stop offset="0%"   stop-color="#0a0a18"/>
        <stop offset="100%" stop-color="#04040c"/>
      </radialGradient>
      <filter id="fDrop" x="-25%" y="-5%" width="150%" height="125%">
        <feDropShadow dx="0" dy="14" stdDeviation="10" flood-color="#000" flood-opacity=".80"/>
      </filter>
      <clipPath id="bodyClip">
        <rect x="14" y="30" width="72" height="155"/>
      </clipPath>`;
    svg.appendChild(defs);

    // ── BASE ──
    const mkEl = (tag, attrs) => {
      const el = document.createElementNS(NS, tag);
      for(const [k,v] of Object.entries(attrs)) el.setAttribute(k,v);
      return el;
    };

    svg.appendChild(mkEl('ellipse',{cx:50,cy:207,rx:33,ry:5,fill:'rgba(0,0,0,0.55)'}));
    svg.appendChild(mkEl('ellipse',{cx:50,cy:204,rx:33,ry:6,fill:'#1a1a28'}));
    svg.appendChild(mkEl('ellipse',{cx:50,cy:203,rx:28,ry:4.5,fill:'#222232'}));
    svg.appendChild(mkEl('ellipse',{cx:50,cy:202,rx:20,ry:3,fill:'#2e2e40'}));
    svg.appendChild(mkEl('polygon',{points:'14,185 86,185 80,200 20,200',fill:'url(#gN)'}));
    svg.appendChild(mkEl('ellipse',{cx:50,cy:185,rx:36,ry:3,fill:'url(#gN)',opacity:.7}));

    // ── BODY SHELL ──
    svg.appendChild(mkEl('rect',{x:14,y:30,width:72,height:155,fill:'url(#gB)',filter:'url(#fDrop)'}));

    // ── DARK BODY BASE (very subtle, so liquid colour shows through) ──
    const bodyBase = document.createElementNS(NS,'g');
    bodyBase.setAttribute('clip-path','url(#bodyClip)');
    bodyBase.innerHTML = `
      <rect x="14" y="30" width="72" height="155" fill="url(#gLabel)" opacity="0.30"/>`;
    svg.appendChild(bodyBase);

    // ── LIQUID — drawn early so label text sits on top ──
    const liqGroup = document.createElementNS(NS,'g');
    liqGroup.setAttribute('clip-path','url(#bodyClip)');
    liqGroup.setAttribute('id','liqGroup');

    const liqRect = document.createElementNS(NS,'rect');
    liqRect.setAttribute('id','liqRect');
    liqRect.setAttribute('x','14');
    liqRect.setAttribute('y', String(LIQ_TOP));
    liqRect.setAttribute('width','72');
    liqRect.setAttribute('height', String(LIQ_H));
    liqRect.setAttribute('fill','url(#gSpirit)');
    liqGroup.appendChild(liqRect);

    const foam1 = document.createElementNS(NS,'ellipse');
    foam1.setAttribute('id','foam1');
    foam1.setAttribute('cx','50');
    foam1.setAttribute('cy', String(LIQ_TOP+4));
    foam1.setAttribute('rx','34');
    foam1.setAttribute('ry','4.5');
    foam1.setAttribute('fill','rgba(255,248,220,0.70)');
    liqGroup.appendChild(foam1);

    const foam2 = document.createElementNS(NS,'ellipse');
    foam2.setAttribute('id','foam2');
    foam2.setAttribute('cx','50');
    foam2.setAttribute('cy', String(LIQ_TOP+2));
    foam2.setAttribute('rx','22');
    foam2.setAttribute('ry','2.5');
    foam2.setAttribute('fill','rgba(255,248,220,0.40)');
    liqGroup.appendChild(foam2);

    // Bubbles inside liquid
    const bubData=[
      {cx:28,dur:1.8,dl:0.0},{cx:40,dur:1.5,dl:0.6},{cx:52,dur:2.1,dl:1.2},
      {cx:64,dur:1.4,dl:1.8},{cx:34,dur:2.0,dl:2.3},{cx:58,dur:1.7,dl:0.3},{cx:46,dur:2.3,dl:0.9}
    ];
    const bubGroup = document.createElementNS(NS,'g');
    bubGroup.setAttribute('id','bubGroup');
    bubData.forEach((b,i)=>{
      const c = document.createElementNS(NS,'circle');
      c.setAttribute('cx', b.cx);
      c.setAttribute('cy', '176');
      c.setAttribute('r', String(1.1+(i%3)*0.5));
      c.setAttribute('fill','rgba(255,215,100,0.95)');
      c.style.animation = `bubbleRise ${b.dur}s ease-in ${b.dl}s infinite`;
      bubGroup.appendChild(c);
    });
    liqGroup.appendChild(bubGroup);
    svg.appendChild(liqGroup);

    // ── LABEL — transparent overlay on top of liquid, NO background rect ──
    const labelGroup = document.createElementNS(NS,'g');
    labelGroup.setAttribute('clip-path','url(#bodyClip)');
    labelGroup.setAttribute('opacity','0.75');
    labelGroup.innerHTML = `
      <rect x="14" y="30" width="72" height="2.5" fill="url(#gT)"/>
      <rect x="14" y="32" width="72" height="2"   fill="url(#gG)"/>
      <text x="50" y="44" text-anchor="middle" font-family="'Bebas Neue',sans-serif" font-size="4" fill="rgba(201,168,76,.80)" letter-spacing="3.5">READY TO DRINK</text>
      <path d="M22,50 Q26,46 30,50 Q34,54 38,50" fill="none" stroke="rgba(201,168,76,.50)" stroke-width=".9" stroke-linecap="round"/>
      <path d="M62,50 Q66,46 70,50 Q74,54 78,50" fill="none" stroke="rgba(201,168,76,.50)" stroke-width=".9" stroke-linecap="round"/>
      <polygon points="50,46 52.5,50 50,54 47.5,50" fill="none" stroke="rgba(201,168,76,.55)" stroke-width=".7"/>
      <polygon points="50,48 51.4,50 50,52 48.6,50" fill="rgba(201,168,76,.35)"/>
      <text x="50" y="91" text-anchor="middle" font-family="'Bebas Neue',sans-serif" font-size="22" fill="#f0e6c8" letter-spacing="3">BOOZE</text>
      <rect x="22" y="93" width="56" height=".8" fill="url(#gG)" opacity=".8"/>
      <text x="50" y="107" text-anchor="middle" font-family="'Bebas Neue',sans-serif" font-size="16" fill="url(#gG)" letter-spacing="6">LAB</text>
      <text x="50" y="118" text-anchor="middle" font-family="'DM Sans',sans-serif" font-size="4" font-style="italic" fill="rgba(0,196,184,.90)" letter-spacing="2">COCKTAIL</text>
      <line x1="18" y1="124" x2="36" y2="124" stroke="rgba(201,168,76,.40)" stroke-width=".6"/>
      <line x1="64" y1="124" x2="82" y2="124" stroke="rgba(201,168,76,.40)" stroke-width=".6"/>
      <polygon points="40,124 42,122 44,124 42,126" fill="rgba(201,168,76,.55)"/>
      <polygon points="56,124 58,122 60,124 58,126" fill="rgba(201,168,76,.55)"/>
      <text x="50" y="127" text-anchor="middle" font-family="'DM Sans',sans-serif" font-size="3.5" fill="rgba(240,230,200,.40)" letter-spacing="2">PERFECTLY MIXED</text>
      <path d="M20,138 Q24,134 28,138 Q32,142 36,138" fill="none" stroke="rgba(201,168,76,.40)" stroke-width=".8" stroke-linecap="round"/>
      <path d="M64,138 Q68,134 72,138 Q76,142 80,138" fill="none" stroke="rgba(201,168,76,.40)" stroke-width=".8" stroke-linecap="round"/>
      <polygon points="50,134 51,137 54,137 51.8,139 52.8,142 50,140.5 47.2,142 48.2,139 46,137 49,137" fill="rgba(201,168,76,.45)"/>
      <text x="50" y="150" text-anchor="middle" font-family="'DM Sans',sans-serif" font-size="3.8" fill="rgba(201,168,76,.75)" letter-spacing="1.5">5% ALC/VOL</text>
      <text x="50" y="159" text-anchor="middle" font-family="'DM Sans',sans-serif" font-size="3.5" fill="rgba(255,255,255,.30)" letter-spacing="1">WITH PREMIUM SPIRITS</text>
      <rect x="14" y="163" width="72" height="2"   fill="url(#gG)"/>
      <rect x="14" y="165" width="72" height="2.5" fill="url(#gT)"/>
      <text x="50" y="175" text-anchor="middle" font-family="'DM Sans',sans-serif" font-size="3.8" fill="rgba(255,255,255,.30)" letter-spacing="2">250ml</text>
      <rect x="15" y="30" width="7"  height="155" fill="url(#gSh)"/>
      <rect x="79" y="30" width="7"  height="155" fill="url(#gEd)"/>`;
    svg.appendChild(labelGroup);

    // ── SHOULDER ──
    svg.appendChild(mkEl('polygon',{points:'14,30 86,30 76,18 24,18',fill:'url(#gN)'}));
    svg.appendChild(mkEl('rect',{x:14,y:28.5,width:72,height:2,fill:'url(#gG)',opacity:.75}));

    // ── NECK + LID ──
    svg.appendChild(mkEl('rect',{x:24,y:9,width:52,height:10,fill:'url(#gN)'}));
    svg.appendChild(mkEl('ellipse',{cx:50,cy:9,rx:26,ry:4.5,fill:'url(#gLid)'}));
    svg.appendChild(mkEl('ellipse',{cx:50,cy:9,rx:20,ry:3.2,fill:'none',stroke:'rgba(0,0,0,.4)','stroke-width':1}));
    svg.appendChild(mkEl('ellipse',{cx:50,cy:8.5,rx:14,ry:2.2,fill:'#8a8a9a'}));
    svg.appendChild(mkEl('ellipse',{cx:44,cy:7.5,rx:7,ry:1.5,fill:'rgba(255,255,255,.18)'}));

    // ── PULL TAB ──
    svg.appendChild(mkEl('rect',{x:46,y:4,width:10,height:6,rx:1.5,fill:'#9a9aaa'}));
    svg.appendChild(mkEl('ellipse',{cx:51,cy:4,rx:3.5,ry:2,fill:'none',stroke:'#b8b8c8','stroke-width':1.2}));
    svg.appendChild(mkEl('circle',{cx:51,cy:7.5,r:1,fill:'#6a6a78'}));
    svg.appendChild(mkEl('rect',{x:47,y:5,width:4,height:1.5,rx:.5,fill:'rgba(255,255,255,.30)'}));

    return svg;
  }

  // ── INSERT CAN ──
  const wrap = document.getElementById('can-wrap');
  wrap.style.cssText = `position:fixed;pointer-events:none;transform-origin:center center;`;
  wrap.appendChild(buildSVG());

  // Rebuild SVG on resize/orientation change (mobile rotation)
  let resizeTimer;
  window.addEventListener('resize', ()=>{
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(()=>{
      wrap.innerHTML='';
      wrap.appendChild(buildSVG());
      assignLiveEls();
    }, 150);
  });

  // Live liquid element refs — reassigned after SVG rebuild
  let liqRect, foam1, foam2, bubGroup, liqGroup;
  function assignLiveEls(){
    liqRect  = document.getElementById('liqRect');
    foam1    = document.getElementById('foam1');
    foam2    = document.getElementById('foam2');
    bubGroup = document.getElementById('bubGroup');
    liqGroup = document.getElementById('liqGroup');
  }
  assignLiveEls();

  // ── SET FILL: directly mutate SVG attributes every frame ──
  function setFill(f) {
    f = clamp(f, 0, 1);
    if (f < 0.01) {
      liqGroup.style.display = 'none';
      return;
    }
    liqGroup.style.display = '';
    const topY = LIQ_TOP + LIQ_H * (1 - f);
    const h    = LIQ_BOT - topY;
    liqRect.setAttribute('y',      topY.toFixed(3));
    liqRect.setAttribute('height', Math.max(0, h).toFixed(3));
    foam1.setAttribute('cy', (topY + 4).toFixed(3));
    foam2.setAttribute('cy', (topY + 2).toFixed(3));
    foam1.setAttribute('ry', f > 0.05 ? '4.5' : '0');
    foam2.setAttribute('ry', f > 0.05 ? '2.5' : '0');
    bubGroup.style.display = f > 0.08 ? '' : 'none';
  }

  // Trail
  const TN=12, tdots=[];
  for(let i=0;i<TN;i++){
    const d=document.createElement('div');
    d.className='tdot';d.style.display='none';
    document.body.appendChild(d);tdots.push(d);
  }
  let tpts=[];
  function pushTrail(x,y){
    tpts.push({x,y});if(tpts.length>TN)tpts.shift();
    tdots.forEach((d,i)=>{
      if(i>=tpts.length){d.style.display='none';return;}
      const pt=tpts[i],age=(i+1)/tpts.length,sz=3+age*14;
      d.style.cssText=`display:block;position:fixed;border-radius:50%;width:${sz}px;height:${sz}px;left:${pt.x-sz/2}px;top:${pt.y-sz/2}px;background:rgba(220,160,40,${age*.28});filter:blur(${Math.max(0,3-age*2.5)}px);`;
    });
  }
  function clearTrail(){tpts=[];tdots.forEach(d=>d.style.display='none');}

  // Drips
  const drips=[];
  for(let i=0;i<4;i++){
    const d=document.createElement('div');d.className='drip';
    d.style.cssText=`display:none;width:${4.5-i*.6}px;height:${9+i*5}px;background:rgba(220,160,40,${.85-i*.18});animation-duration:${.65+i*.25}s;animation-delay:${i*.2}s;`;
    document.body.appendChild(d);drips.push(d);
  }
  function showDrips(x,y){
    const cw=CAN_W(),ch=CAN_H();
    drips.forEach((d,i)=>{d.style.display='block';d.style.left=(x+cw*.18+i*10)+'px';d.style.top=(y+ch*.40)+'px';});
  }
  function hideDrips(){drips.forEach(d=>d.style.display='none');}

  const gone=document.getElementById('all-gone');

  function place(x,y,rot,op){
    const cw=CAN_W(),ch=CAN_H();
    wrap.style.width  = cw+'px';
    wrap.style.height = ch+'px';
    wrap.style.left   = (x-cw/2)+'px';
    wrap.style.top    = (y-ch/2)+'px';
    wrap.style.opacity  = op;
    wrap.style.transform= `rotate(${rot}deg)`;
    wrap.style.filter   = `drop-shadow(0 12px 30px rgba(201,140,40,.38)) drop-shadow(0 4px 10px rgba(0,0,0,.9))`;
  }

  // PHASES

  /*
    PHASE 1 — CLOCKWISE SWIRL FLY
    Can enters from off-screen left and traces a wide clockwise arc across the
    screen, spinning clockwise (positive degrees) the whole way, decelerating
    as it arrives at the rest position on the right.

    Path: start far left at mid-height → arc through top-centre → arrive right.
    The arc is a quadratic bezier:
      start : (-CAN_W,  CY)
      control: (CX,     TOP_Y * 0.6)   ← pulls path upward = clockwise loop
      end   : (RST_X,  RST_Y)

    Rotation: continuous clockwise spin 0 → 720° (2 full turns), easing out.
    Duration: 2200ms for a leisurely, confident swirl.
  */
  function phSwirl(el){
    const DUR=2200, t=Math.min(el/DUR,1);
    const et = ease3(t);
    const cw=CAN_W();

    const sx=-cw,  sy=CY();
    const cx2=CX()*0.5, cy2=TOP_Y()*0.5;
    const ex=RST_X(), ey=RST_Y();
    const mt=et, mt1=1-mt;
    const x = mt1*mt1*sx + 2*mt1*mt*cx2 + mt*mt*ex;
    const y = mt1*mt1*sy + 2*mt1*mt*cy2 + mt*mt*ey;

    const rot = 720 * ease2(t);
    const op = clamp(el/200, 0, 1);
    place(x, y, rot, op);

    if(t>0.03 && t<0.92) pushTrail(x,y);
    else if(t>=0.92) clearTrail();
    return t>=1;
  }

  function phSettle(el){
    const DUR=600, t=Math.min(el/DUR,1);
    const bob = Math.sin(t*Math.PI*3)*(1-t)*10;
    place(RST_X(), RST_Y()+bob, 0, 1);
    return t>=1;
  }

  function phDrain(el){
    const DUR=5500, t=Math.min(el/DUR,1);
    setFill(1-eio2(t));
    place(RST_X(), RST_Y(), 0, 1);
    showDrips(RST_X(), RST_Y());
    return t>=1;
  }

  function phAllGone(el){
    setFill(0); hideDrips();
    gone.style.left   = RST_X()+'px';
    gone.style.top    = (RST_Y()+CAN_H()*0.52)+'px';
    gone.style.opacity= '1';
    place(RST_X(), RST_Y(), 0, 1);
    return el>=1600;
  }

  function phFade(el){
    const DUR=700, t=Math.min(el/DUR,1);
    wrap.style.opacity = String(1-t);
    gone.style.opacity = String(1-t);
    return t>=1;
  }

  const next={swirl:'settle',settle:'drain',drain:'allgone',allgone:'fade',fade:'gap'};
  let phase='swirl', phStart=null, gapUntil=null;

  function init(){
    setFill(1); clearTrail(); hideDrips();
    gone.style.opacity='0';
    place(-CAN_W(), CY(), 0, 0);
    phase='swirl'; phStart=null;
  }

  function tick(ts){
    if(phase==='gap'){
      if(ts>=gapUntil){init();phStart=ts;}
      requestAnimationFrame(tick); return;
    }
    if(!phStart) phStart=ts;
    const el=ts-phStart;
    let done=false;
    if     (phase==='swirl')   done=phSwirl(el);
    else if(phase==='settle')  done=phSettle(el);
    else if(phase==='drain')   done=phDrain(el);
    else if(phase==='allgone') done=phAllGone(el);
    else if(phase==='fade')    done=phFade(el);
    if(done){phase=next[phase];phStart=ts;if(phase==='gap')gapUntil=ts+1400;}
    requestAnimationFrame(tick);
  }

  init();
  requestAnimationFrame(tick);
})();
</script>
</body>
</html>
